{"version":3,"sources":["webpack:///webpack/bootstrap 389d080d6efa89fd862c","webpack:///./backend/index.js","webpack:///external \"request\"","webpack:///external \"json-server\"","webpack:///external \"body-parser\"","webpack:///./backend/ResourceUtils.js","webpack:///external \"faker\"","webpack:///external \"validate.js\"","webpack:///external \"moment\""],"names":[],"mappings":"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","file":"server.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 389d080d6efa89fd862c\n **/","// Declare letiables here for global use\n\n// F deployment, the two admin server will serve\n// the bundle.js front-end app from build/bundle.js\n// so that this application can be deployed as a simple node\n// application.\n\n// We need to work out how the two json servers can be\n// slimmed down into one json server handling both the admin\n// and public apis\n\n// Refactor server code in to separate files, making\n// good use of ES2016 import / export code.\n\n// Remove references to Faker.js since this is an implementation\n// detail.\n\n// Implement testing\n\nimport http from 'request';\nimport JsonServer from 'json-server';\nimport BodyParser from 'body-parser';\nimport ResourceUtils from 'ResourceUtils';\n\n// Path to adminDb.json relative to the build folder\nconst pathToAdminPersistentStorage = './backend/adminDb.json';\nlet dataRouter;\n\nclass Server {\n\tdataRouter: {};\n\n\t/*=============================================================================\n\t\tRun the admin database (to store resource descriptions)\n\t=============================================================================*/\n\tstartAdminServer() {\n\t\tthis.adminServer = JsonServer.create();\n\t\tthis.adminRouter = JsonServer.router(pathToAdminPersistentStorage);\n\t\tlet jsonServerMiddleware = JsonServer.defaults();\n\n\t\tthis.adminServer.use(jsonServerMiddleware);\n\t\tthis.adminServer.use(this.databaseServerUpdaterMiddleware);\n\t\tthis.adminServer.use(this.adminRouter);\n\n\t\tthis.adminServer.listen(1401, () => {\n\t\t\tconsole.log('Admin database running at: http://localhost:1401');\n\t\t\tthis.startDatabaseServer();\n\t\t});\n\t}\n\n\t/*=============================================================================\n\t\tStart up the database API (one that will be consumed by client's\n\t\tfront-end projects).\n\t\tUses JSON server (see docs for more info)\n\t=============================================================================*/\n\tstartDatabaseServer() {\n\t\thttp('http://localhost:1401/resources', (error, response, body) => {\n\t\t\tlet resources = JSON.parse(body);\n\t\t\tlet database = ResourceUtils.generateDatabase(resources);\n\t\t\tthis.dataServer = JsonServer.create();\n\t\t\tdataRouter = JsonServer.router(database);\n\n\t\t\tthis.dataServer.use(BodyParser.json());\n\t\t\tthis.dataServer.use(JsonServer.defaults());\n\t\t\tthis.dataServer.use(this.resourceMethodHelperMiddleware.bind(resources));\n\t\t\tthis.dataServer.use(dataRouter);\n\n\t\t\tthis.dataServer.listen(1400, function () {\n\t\t\t\tconsole.log('Database running at: http://localhost:1400');\n\t\t\t});\n\t\t});\n\t}\n\n\tresourceMethodHelperMiddleware(req, res, next, resources) {\n\t\t// Check that the method is supported by the configuration\n\t\t// first get the resource description in question and then\n\t\t// check that the method is supported before passing it to\n\t\t// json server. Otherwise throw a 405 method not allowed\n\t\tlet requestedResourceName = req.originalUrl.split('/')[1];\n\t\tlet requestedResourceDescription = resources.find((resource) => {\n\t\t\treturn resource.name === requestedResourceName;\n\t\t});\n\n\t\tif (requestedResourceDescription) {\n\t\t\tif (req.method === 'GET' && requestedResourceDescription.supportedMethods.get) {\n\t\t\t\tnext();\n\t\t\t} else if (req.method === 'POST' && requestedResourceDescription.supportedMethods.post) {\n\t\t\t\tlet validationErrors = ResourceUtils.validateRequest(requestedResourceDescription, req.body);\n\t\t\t\tif (validationErrors) {\n\t\t\t\t\tres.status(400).send(validationErrors);\n\t\t\t\t} else {\n\t\t\t\t\tnext();\n\t\t\t\t}\n\t\t\t} else if (req.method === 'PUT' && requestedResourceDescription.supportedMethods.put) {\n\t\t\t\tnext();\n\t\t\t} else if (req.method === 'DELETE' && requestedResourceDescription.supportedMethods.destroy) {\n\t\t\t\tnext();\n\t\t\t} else {\n\t\t\t\tres.status(405).send(`Method isn't supported for this resource`);\n\t\t\t}\n\t\t} else {\n\t\t\t// The resource doesn't exist but JSON server will handle the response for us\n\t\t\tnext();\n\t\t}\n\t}\n\n\t/*=============================================================================\n\t\tWhen resources are updated, restart the database server\n\t=============================================================================*/\n\tdatabaseServerUpdaterMiddleware(req, res, next) {\n\t\t// Pass immediately on to JSON server\n\t\tnext();\n\n\t\t// Stop and start the JSON server\n\t\tif (req.method === 'POST' ||\n\t\t\t\treq.method === 'PUT' ||\n\t\t\t\treq.method === 'DELETE') {\n\t\t\tsetTimeout(() => {\n\t\t\t\thttp('http://localhost:1401/resources', (error, response, body) => {\n\t\t\t\t\tconsole.log('Database updated at: http://localhost:1400');\n\t\t\t\t\tlet resources = JSON.parse(body);\n\t\t\t\t\tlet database = ResourceUtils.generateDatabase(resources);\n\t\t\t\t\tdataRouter.db.setState(database);\n\t\t\t\t});\n\t\t\t}, 2000);\n\t\t}\n\t}\n\n\tstart() {\n\t\tthis.startAdminServer();\n\t}\n}\n\nconst server = new Server();\nserver.start();\nexport default server;\n\n\n\n/** WEBPACK FOOTER **\n ** ./backend/index.js\n **/","module.exports = require(\"request\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"request\"\n ** module id = 1\n ** module chunks = 0\n **/","module.exports = require(\"json-server\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"json-server\"\n ** module id = 2\n ** module chunks = 0\n **/","module.exports = require(\"body-parser\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"body-parser\"\n ** module id = 3\n ** module chunks = 0\n **/","import faker from 'faker';\nimport validate from 'validate.js';\nimport moment from 'moment';\n\n/*=============================================================================\n\tSet some options for date validation\n=============================================================================*/\nvalidate.extend(validate.validators.datetime, {\n  parse: function (value) {\n    return +moment.utc(value);\n  },\n  format: function (value, options) {\n    let format = options.dateOnly ? 'YYYY-MM-DD' : 'YYYY-MM-DD hh:mm:ss';\n    return moment.utc(value).format(format);\n  }\n});\n\n/*=============================================================================\n\tAdd new validators\n=============================================================================*/\nvalidate.validators.boolean = function (value) {\n\tif (value !== false && value !== true) {\n\t\treturn 'must be true or false';\n\t}\n};\n\nclass ResourceUtils {\n\t/*=============================================================================\n\t\tGenerate a full resource (array of models)\n\t\ttakes a description that defines what the resource looks like\n\t\tincluding it's model and associated description\n\t=============================================================================*/\n\tgenerateResource(description, resources, isNestedResource) {\n\t\tif (resources) {\n\t\t\tthis.resources = resources;\n\t\t}\n\n\t\tif (description.type === 'array') {\n\t\t\tlet resource = [];\n\t\t\tfor (let i = 0, x = description.length; i < x; i++) {\n\t\t\t\tlet model = this.generateModel(description.model);\n\t\t\t\tif (isNestedResource !== true) {\n\t\t\t\t\tmodel.id = i + 1;\n\t\t\t\t}\n\t\t\t\tresource.push(model);\n\t\t\t}\n\n\t\t\treturn resource;\n\t\t}\n\t\treturn this.generateModel(description.model);\n\t}\n\n\t/*=============================================================================\n\t\tReturns a model object based on it's description\n\t=============================================================================*/\n\tgenerateModel(description) {\n\t\tlet model = {};\n\n\t\tfor (let i = 0, x = description.length; i < x; i++) {\n\t\t\tlet key = description[i].key;\n\t\t\tmodel[key] = this.generatePropertyValue(description[i]);\n\t\t}\n\n\t\treturn model;\n\t}\n\n\t/*=============================================================================\n\t\tReturns a value for a properties key (for instance first_name)\n\t\tGet's passed in the property description and delegates to utility functions\n\t\tbased on the properties type\n\t=============================================================================*/\n\tgeneratePropertyValue(property) {\n\t\tif (property.type === 'random') {\n\t\t\treturn this.generateRandomValue(property);\n\t\t} else if (property.type === 'childResource') {\n\t\t\treturn this.generateValueFromAnotherResource(property);\n\t\t} else if (property.type === 'object') {\n\t\t\tif (property.resource && property.resource.type) {\n\t\t\t\treturn this.generateResource(property.resource, null, true);\n\t\t\t}\n\t\t\treturn null;\n\t\t} else if (property.type === 'predefined') {\n\t\t\treturn property.predefinedValue;\n\t\t}\n\t}\n\n\t/*=============================================================================\n\t\tReturns a random value given a properties description\n\t\tUses faker.js (see docs for more info)\n\t=============================================================================*/\n\tgenerateRandomValue(property) {\n\t\tif (property.fakerCategory && property.fakerSubCategory) {\n\t\t\tlet args = [];\n\t\t\tif (property.fakerParams) {\n\t\t\t\tlet keys = Object.keys(property.fakerParams);\n\t\t\t\targs = keys.map((key) => property.fakerParams[key]);\n\t\t\t}\n\t\t\treturn faker[property.fakerCategory][property.fakerSubCategory].apply(null, args);\n\t\t}\n\t\treturn null;\n\t}\n\n\t/*=============================================================================\n\t\tCheck whether a child resource has a model key that requests it's parent i.e:\n\n\t\tusers_model : [{\n\t\t\ttype: 'childResource',\n\t\t\tchildResourceName: 'comments'\n\t\t}];\n\t\tcomments_model: [{\n\t\t\ttype: 'childResource',\n\t\t\tchildResourceName: 'users'\n\t\t}];\n\n\t\tThe above will fail since it'll cause an infinite loop of generateResource\n\t\tcalls.\n\t=============================================================================*/\n\tdoesChildResourceContainsRecursiveParent(resourceName, childResource) {\n\t\tfor (let i = 0, x = childResource.model.length; i < x; i++) {\n\t\t\tif (childResource.model[i].type === 'childResource') {\n\t\t\t\tif (childResource.model[i].name === resourceName) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\t/*=============================================================================\n\t\tGet a random sub-set of an array\n\t=============================================================================*/\n\tgetRandomSample(array, count) {\n    let indices = [];\n    let result = new Array(count);\n    for (let i = 0; i < count; i++) {\n      let j = Math.floor(Math.random() * (array.length - i) + i);\n      result[i] = !array[indices[j] ? j : indices[j]];\n      indices[j] = !indices[i] ? i : indices[i];\n    }\n    return result;\n\t}\n\n\t/*=============================================================================\n\t\tGenerate a key's value from another resource i.e. a post has an author\n\t\twhere posts and users are resources\n\t=============================================================================*/\n\tgenerateValueFromAnotherResource(property) {\n\t\tlet resourceDescription;\n\t\tfor (let i = 0, x = this.resources.length; i < x; i++) {\n\t\t\tif (this.resources[i].name === property.childResourceName) {\n\t\t\t\tresourceDescription = this.resources[i];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (resourceDescription) {\n\t\t\tlet childResourceContainsRecursiveParent = this.doesChildResourceContainsRecursiveParent(property.childResourceName, resourceDescription);\n\t\t\tif (childResourceContainsRecursiveParent) {\n\t\t\t\treturn 'ERROR, ' + property.childResourceName + ' is a recursive key';\n\t\t\t}\n\t\t\t// Refactor this line below so it doesn't generate the resource\n\t\t\t// but is the prevously-generated resource.\n\t\t\tlet resource = this.generateResource(resourceDescription);\n\n\t\t\tif (property.childResourceMethod === 'array') {\n\t\t\t\tif (property.childResourceLimit) {\n\t\t\t\t\tlet limit = parseFloat(property.childResourceLimit);\n\t\t\t\t\tif (limit > resource.length) {\n\t\t\t\t\t\treturn resource;\n\t\t\t\t\t}\n\t\t\t\t\treturn this.getRandomSample(resource, limit);\n\t\t\t\t}\n\t\t\t\treturn resource;\n\t\t\t} else if (property.childResourceMethod === 'object') {\n\t\t\t\treturn resource[Math.floor((Math.random() * resource.length))];\n\t\t\t} else if (property.childResourceMethod === 'id') {\n\t\t\t\treturn resource[Math.floor((Math.random() * resource.length))].id;\n\t\t\t}\n\t\t}\n\t}\n\n\t/*=============================================================================\n\t\tReturns a full database object from the descriptions stored in the\n\t\tadmin DB\n\t=============================================================================*/\n\tgenerateDatabase(resources) {\n\t\tthis.resources = resources;\n\t\tlet database = {};\n\n\t\tfor (let i = 0, x = resources.length; i < x; i++) {\n\t\t\tlet resource = resources[i];\n\t\t\tdatabase[resource.name] = this.generateResource(resource);\n\t\t}\n\n\t\treturn database;\n\t}\n\n\t/*=============================================================================\n\t\tValidates a POST or PUT request against the model description if the key\n\t\tis a required parameter.\n\t=============================================================================*/\n\tvalidateRequest(resource, request) {\n\t\treturn validate(request, resource.validationConfig);\n\t}\n\n\t/*=============================================================================\n\t\tGenerate validation config (for validate.js) for a resource\n\t=============================================================================*/\n\tgenerateValidationConfigForResource(resource) {\n\t\tlet validationConfig = {};\n\n\t\t// Generate a validate.js configuraton from the model description\n\t\tresource.model.map((parameter) => {\n\t\t\tif (parameter.type === 'childResource') {\n\t\t\t\t// Handle a nested resource and validate it\n\t\t\t} else if (parameter.type === 'object') {\n\t\t\t\t// Handle a nested object / array and validate it\n\t\t\t} else {\n\t\t\t\tvalidationConfig[parameter.key] = this.getSingleRequestParameterValidationRequirements(parameter);\n\t\t\t}\n\t\t});\n\n\t\treturn validationConfig;\n\t}\n\n\t/*=============================================================================\n\t\tGenerate the validate.js requirements for a single model.\n\t=============================================================================*/\n\tgetSingleRequestParameterValidationRequirements(parameter) {\n\t\tlet config = {};\n\n\t\tif (parameter.required) {\n\t\t\tconfig.presence = true;\n\t\t}\n\n\t\tif (parameter.type === 'predefined') {\n\t\t\t// Handle predefined values\n\t\t} else if (parameter.type === 'random') {\n\t\t\tlet exampleValue = this.generateRandomValue(parameter);\n\t\t\tlet isBoolean = typeof (exampleValue) === 'boolean';\n\t\t\tlet isString = typeof (exampleValue) === 'string';\n\n\t\t\t// Date validation (range)\n\t\t\tif (parameter.fakerCategory === 'date') {\n\t\t\t\tlet dateType = parameter.fakerSubCategory;\n\t\t\t\tlet fakerParams = parameter.fakerParams;\n\t\t\t\tif (dateType === 'between') {\n\t\t\t\t\tconfig.datetime = {};\n\t\t\t\t\tif (fakerParams.from) {\n\t\t\t\t\t\tconfig.datetime.earliest = fakerParams.from;\n\t\t\t\t\t}\n\t\t\t\t\tif (fakerParams.to) {\n\t\t\t\t\t\tconfig.datetime.latest = fakerParams.to;\n\t\t\t\t\t}\n\t\t\t\t} else if (dateType === 'future') {\n\t\t\t\t\tconfig.datetime = {};\n\t\t\t\t\tif (fakerParams.refDate) {\n\t\t\t\t\t\tconfig.datetime.earliest = fakerParams.refDate;\n\t\t\t\t\t}\n\t\t\t\t\tif (fakerParams.years) {\n\t\t\t\t\t\t//\n\t\t\t\t\t\t// NOTE: Refactor this so it works when this is run so it's always looking at todays date\n\t\t\t\t\t\t// Consider storing latest as the string 'today' and checking for that string when\n\t\t\t\t\t\t// validation is run\n\t\t\t\t\t\t//\n\n\t\t\t\t\t\tlet refDate = fakerParams.refDate || new Date();\n\t\t\t\t\t\tconfig.datetime.latest = moment(refDate).add(fakerParams.years, 'years').format('YYYY-MM-DD');\n\t\t\t\t\t}\n\t\t\t\t} else if (dateType === 'past') {\n\t\t\t\t\tconfig.datetime = {};\n\t\t\t\t\tif (fakerParams.refDate) {\n\t\t\t\t\t\tconfig.datetime.latest = fakerParams.refDate;\n\t\t\t\t\t}\n\t\t\t\t\tif (fakerParams.years) {\n\t\t\t\t\t\tconfig.datetime.earliest = moment(fakerParams.refDate).subtract(fakerParams.years, 'years').format('YYYY-MM-DD');\n\t\t\t\t\t}\n\t\t\t\t} else if (dateType === 'month') {\n\t\t\t\t\tif (parameter.fakerSubCategory === 'month') {\n\t\t\t\t\t\tconfig.inclusion = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'November', 'December'];\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Else it's just a random date, no min or max needed\n\t\t\t\t\tconfig.datetime = true;\n\t\t\t\t}\n\t\t\t} else if (parameter.fakerSubCategory === 'email') {\n\t\t\t\tconfig.email = true;\n\t\t\t} else if (parameter.fakerSubCategory === 'url') {\n\t\t\t\tconfig.url = true;\n\t\t\t} else if (isString && parameter.fakerSubCategory === 'arrayElement') {\n\t\t\t\t// We have to check if array is an array of strings since validate.js doesn't support\n\t\t\t\t// nested objects. TODO: write a validator that supports deepEqual of nested objects.\n\t\t\t\tconfig.inclusion = parameter.fakerParams.json;\n\t\t\t} else if (isBoolean) {\n\t\t\t\tconfig.boolean = true;\n\t\t\t} else if (parameter.fakerSubCategory === 'number') {\n\t\t\t\tconfig.numericality = true;\n\t\t\t}\n\t\t}\n\n\t\treturn config;\n\t}\n}\n\nexport default new ResourceUtils();\n\n\n\n/** WEBPACK FOOTER **\n ** ./backend/ResourceUtils.js\n **/","module.exports = require(\"faker\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"faker\"\n ** module id = 5\n ** module chunks = 0\n **/","module.exports = require(\"validate.js\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"validate.js\"\n ** module id = 6\n ** module chunks = 0\n **/","module.exports = require(\"moment\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"moment\"\n ** module id = 7\n ** module chunks = 0\n **/"],"sourceRoot":""}